<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

</body>
<script>
    class User {
        ajax(user) {
            let url = `http://localhost/4.2user.php`
            return new Promise((resolve, reject) => {
                let xhr = new XMLHttpRequest();
                xhr.open('GET', `${url}?name=${user}`);
                xhr.send();
                xhr.onload = function () {
                    if (this.status == 200) {
                        resolve(JSON.parse(this.response));
                    } else if (this.status == 404) {
                        reject(new HttpError('用户不存在'));
                    } else {
                        reject('加载失败');
                    }
                }
                xhr.onerror = function () {
                    reject(this);
                }
            })
        }
        render(users) {
            users.reduce((promise, user) => {
                return promise.then(_ => {
                    return this.ajax(user);
                }).then(user => {
                    return this.view(user);
                })
            }, Promise.resolve())
        }
        view(user) {
            return new Promise(resolve => {
                console.log(user);
            })
        }
    }
    new User().render(['cc', 'lele']);
</script>

</html>